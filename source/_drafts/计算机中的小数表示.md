---
title: 计算机中的小数表示
tags: 读书笔记,编码
---

我们知道整数在计算机中使用补码表示的，不知道大家有没有想过，小数在计算机中如何表示的呢？

我们都知道`System.out.println(0.3 - 0.2 == 0.1);`在Java中返回false，有考虑过为什么呢？

# 定点格式

如果让我设计浮点数的表示，最容易想到的就是定点格式表示法。定点表示法就是将一个个数字翻译成对应的二进制数，常见的就是BCD码。

十进制 | BCD码
:-: | :--:
 0  |  0000
 1  |  0001
 2  |  0010
 3  |  0011
 4  |  0100
 5  |  0101
 6  |  0110
 7  |  0111
 8  |  1000
 9  |  1001
 
 比如1.5对应的二进制就是0000 0001 0101，-2.8的二进制是0001 0010 1000
 
 0000代表正数，0001代表负数，你可能会想，这里没有小数点的信息，我们怎么能确定第一个二进制不是15而是1.5呢？
 
 之所以这种表示方法叫做定点格式，就是因为小数点的位置是我们事先约定的，比如上面约定只会有一个小数，这种表示法常用于财务，用于精确计算，一般需要保持两位小数。
 
 这总方式的缺点在于无法表示很大或者很小的数字，这样需要很大的内存空间。

# 浮点格式

100.25=1.0025*10<sup>2</sup>

计算机中使用下面存储小数，只需要存储三个数值，s，f，e。
v=-1<sup>s</sup>\*1.f\*2<sup>e-127</sup>

IEEE浮点数规范有两种格式，4个字节的单精度和8个字节的双精度




## 示例分析

```java

float l = 0.25f;
System.out.println(Integer.toBinaryString(Float.floatToIntBits(l)));

//output
111110100000000000000000000000
```
java中float是单精度浮点数，也就是4个字节32位，将上面结果补充到32个字节，也就是00111110100000000000000000000000，按照上面的格式拆解，0，01111101，00000000000000000000000。

第一个0代表是正数，01111101代表125，00000000000000000000000代表0，带入上面的公式：v=-1<sup>0</sup>\*1.0\*2<sup>125-127</sup>



```java
float v = 0.3f - 0.2f;
float m = 0.1f;
int l1 = Float.floatToIntBits(v);
int l2 = Float.floatToIntBits(m);

System.out.println(Integer.toBinaryString(l1));
System.out.println(Integer.toBinaryString(l2));

//output
111101110011001100110011001110
111101110011001100110011001101
```
上面的代码应该理解为什么在java里0.3f-0.2f!=0.1f了。



