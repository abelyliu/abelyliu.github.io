---
title: 分组与聚集
date: 2016-11-15 08:42:09
tags: SQL
category: Database
---
当我们使用SQL进行查询时，返回的是数据库内的信息，但有时候我们需要对数据进行简单的处理，而分组和聚集就是我们最常用的工具。
<!--more-->

## 分组概念
分组顾名思义，就是对结果集进行分类,一般使用group by，数据库表如下：
![](/images/32.png)
```sql
select name,count(*) from table2 group by name
```
![](/images/33.png)
我们可以使用having对结果进行过滤，由于group by子句在where子句之后运行，所有会使用having。
```sql
select name,count(*) from table2 group by name having name != 'c'
```
![](/images/34.png)

_值得注意的是，select查询的列必须是在分组的列里，上面如果写成下面格式会出错：_
```sql
select uuid, name,count(*) from table2 group by name
```
![](/images/35.png)
如果写成下列格式则会正常显示：
```sql
select uuid, name,count(*) from table2 group by name ,uuid
```
![](/images/36.png)

## 聚集函数
聚集函数是对某个分组的所有行进行特定的操作。每种数据库都有其独特的聚集函数，有些则在所有的主流服务器上都得到了实现。

#### Max()
返回集合中的最大值
#### Min()
返回集合中的最小值
#### Avg()
返回集合中的平均值
#### Sum()
返回集合中所有值的合
#### Count()
返回集合中值的个数

## 使用技巧
#### 对独立值计数
count函数可以对某一列进行统计
```sql
select count(cloumn_name) from table
```
#### 使用表达式
```sql
select max(cloumn1-cloumn2) from table
```
#### 处理null
表中增加了一个null值，sum()、max()、avg()函数的返回值不会发生变化，这表明它们忽略任何遇到的null值。count(*)值会增1，因为count为表的行数，count(cloumn)不会发生变化，也会忽略null值。
